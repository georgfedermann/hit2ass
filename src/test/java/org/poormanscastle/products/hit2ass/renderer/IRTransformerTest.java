package org.poormanscastle.products.hit2ass.renderer;

import org.apache.commons.lang3.StringUtils;
import org.junit.Test;
import org.poormanscastle.products.hit2ass.TestUtils;
import org.poormanscastle.products.hit2ass.ast.domain.ClouBaustein;
import org.poormanscastle.products.hit2ass.parser.javacc.HitAssAstParser;
import org.poormanscastle.products.hit2ass.renderer.domain.Workspace;
import org.poormanscastle.products.hit2ass.transformer.FixedTextMerger;
import org.poormanscastle.products.hit2ass.transformer.InsertBlanksVisitor;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertTrue;

/**
 * Created by georg.federmann@poormanscastle.com on 5/9/16.
 */
public class IRTransformerTest {

    private ClouBaustein baustein;
    private HitAssAstParser parser;
    private FixedTextMerger merger = new FixedTextMerger();
    private InsertBlanksVisitor blanksVisitor = new InsertBlanksVisitor();
    private IRTransformer irTransformer = new IRTransformer();

    @Test
    public void testHitCommandReturn() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("HitCommandReturn"), "UTF-8");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Gleichzeitig ersuchen wir den (das) beiliegende(n) Bescheid (INFO)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, Text{name='text', text='anlässlich der Information zu expedieren bzw. auszuhändigen und'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='wie folgt storniert haben:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='5'}]}}", workspace.toString());
        String acr = workspace.getContent();
        assertFalse(StringUtils.isBlank(acr));
    }

    @Test
    public void testIfElse() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("SimpleIfLetter"), "UTF-8");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String acrString = workspace.getContent();
        assertFalse(StringUtils.isBlank(acrString));
    }

    @Test
    public void testSection() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("SectionBreak"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String acrString = workspace.getContent();
        assertFalse(StringUtils.isBlank(acrString));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  'Jim' ) '}, DynamicContentReference{name='Global Variable: lastName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lastName',  'Raynor' ) '}, DynamicContentReference{name='Global Variable: gender', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'gender',  'm' ) '}, DynamicContentReference{name='Global Variable: shoppingItem', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'shoppingItem',  'Adler' ) '}, DynamicContentReference{name='Global Variable: numberOfNewLines', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'numberOfNewLines', 5) '}, Text{name='text', text='Sehr geehrter Herr '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Wir danken Ihnen für Ihre Bestellung und bitten Sie um Ihre Zurkenntnisnahme:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Ihre Bestellung wird nicht ausgeführt.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='3'}, Text{name='text', text='Aufwiederhören.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", workspace.toString());
    }

    @Test
    public void testAssignments() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("Assignments"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String probe = workspace.toString();
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Here is some fixed text for you.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Global Variable: myVar', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'myVar',  'John2' ) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): quargl', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'quargl', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, DynamicContentReference{name='Scalar Assignment: quargl', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'quargl',  'Speed'  )'}, DynamicContentReference{name='Scalar Assignment: varName', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'varName',  'For'  )'}, DynamicContentReference{name='Scalar Assignment: anotherVisitor', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'anotherVisitor',  'Need'  )'}, Text{name='text', text='This is the value of anotherVisitor: '}, DynamicContentReference{name='Print: anotherVisitor', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'anotherVisitor')  '}, Text{name='text', text=','}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='this is the value of varName: '}, DynamicContentReference{name='Print: varName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'varName')  '}, Text{name='text', text=','}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='and this is the vlaue of quargl: '}, DynamicContentReference{name='Print: quargl', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'quargl')  '}, Text{name='text', text='.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Now, intitializing a list, setting slot values and retrieving slot values:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, ListDeclaration{listVariableName='someNames', components='[]'}, ListAddItem{listVariableName='someNames', newValue=' 'John' ', components='[]'}, ListAddItem{listVariableName='someNames', newValue=' 'Joanne' ', components='[]'}, ListAddItem{listVariableName='someNames', newValue=' 'Eli' ', components='[]'}, Text{name='text', text='someNames[1]= '}, DynamicContentReference{name='Print: someNames', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'someNames', 1)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='someNames[2]= '}, DynamicContentReference{name='Print: someNames', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'someNames', 2)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='someNames[3|= '}, DynamicContentReference{name='Print: someNames', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'someNames', 3)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Now setting someNames[2] to Lisa'}, DynamicContentReference{name='List Assignment: someNames', xpath='hit2assext:setListValueAt(var:read('renderSessionUuid'), 'someNames', 2,  'Lisa' )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='someNames[2]= '}, DynamicContentReference{name='Print: someNames', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'someNames', 2)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}}", probe);
    }

    @Test
    public void testSubstring() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("Substring"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[DynamicContentReference{name='Global Variable: myString', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'myString',  'Let freedom ring' ) '}, DynamicContentReference{name='Global Variable: mySubstring', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'mySubstring',  substring(hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'myString'), 5, 11 + 1 - 5 ) ) '}, Text{name='text', text='The substring [5,11] of \"'}, DynamicContentReference{name='Print: myString', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'myString')  '}, Text{name='text', text='\" is \"'}, DynamicContentReference{name='Print: mySubstring', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'mySubstring')  '}, Text{name='text', text='\".'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, IfThenElseParagraph{condition=BinaryOperatorExpression{codePosition=begin line/column 9/4; end line/column 9/14, lhs=IdExpression{id='mySubstring', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=EQ, rhs=TextExpression{codePosition=begin line/column 9/18; end line/column 9/26, value='freedom'}, value=null}, components=[IfThenParagraph{components=[Text{name='text', text='Hey, that worked!'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}, IfElseParagraph{components=[Text{name='text', text='OK, we will have to fix that.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}]}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testWhile() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("While"), "UTF-8");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        assertNotNull(baustein);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 4/1; end line/column 4/5, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 4/1; end line/column 4/5, head=FixedTextImpl{codePosition=begin line/column 4/1; end line/column 4/5, textBuffer=Let's test away with the lelement WHILE-loop szenario!}, tail=PairClouBausteinElementList{codePosition=begin line/column 5/1; end line/column 5/2, head=HitCommandStatement{codePosition=begin line/column 5/1; end line/column 5/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 5/3; end line/column 5/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/4; end line/column 6/11, head=GlobalListDeclarationStatement{codePosition=begin line/column 6/4; end line/column 6/11, listId='indtext0', listExpression=null}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/13; end line/column 7/15, head=GlobalDeclarationStatement{codePosition=begin line/column 7/13; end line/column 7/15, expression=TextExpression{codePosition=begin line/column 7/13; end line/column 7/15, value='x'}, id='lelement', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/14; end line/column 9/15, head=GlobalDeclarationStatement{codePosition=begin line/column 9/14; end line/column 9/15, expression=TextExpression{codePosition=begin line/column 9/14; end line/column 9/15, value=''}, id='firstName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/13; end line/column 10/14, head=GlobalDeclarationStatement{codePosition=begin line/column 10/13; end line/column 10/14, expression=TextExpression{codePosition=begin line/column 10/13; end line/column 10/14, value=''}, id='lastName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 12/5; end line/column 12/13, head=DynamicValue{codePosition=begin line/column 12/5; end line/column 12/13, name='firstName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 13/5; end line/column 13/12, head=DynamicValue{codePosition=begin line/column 13/5; end line/column 13/12, name='lastName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 15/5; end line/column 15/12, head=DynamicValue{codePosition=begin line/column 15/5; end line/column 15/12, name='lelement'}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/1; end line/column 16/2, head=WhileStatement{codePosition=begin line/column 16/1; end line/column 16/2, condition=BinaryOperatorExpression{codePosition=begin line/column 16/4; end line/column 16/11, lhs=IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 16/16; end line/column 16/18, value='*'}, value=null}, whileBody=PairClouBausteinElementList{codePosition=begin line/column 17/8; end line/column 17/15, head=ListConcatenationStatement{codePosition=begin line/column 17/8; end line/column 17/15listId='indtext0', listExpression=LastExpressionList{codePosition=begin line/column 17/21; end line/column 17/28head='IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}}}, tail=LastClouBausteinElementList{head=DynamicValue{codePosition=begin line/column 18/9; end line/column 18/16, name='lelement'}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/1; end line/column 21/4, head=FixedTextImpl{codePosition=begin line/column 21/1; end line/column 21/4, textBuffer=This is a message from }, tail=PairClouBausteinElementList{codePosition=begin line/column 21/27; end line/column 21/35, head=PrintStatement{codePosition=begin line/column 21/27; end line/column 21/35, expression='IdExpression{id='firstName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 21/40; end line/column 21/47, head=PrintStatement{codePosition=begin line/column 21/40; end line/column 21/47, expression='IdExpression{id='lastName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/48; end line/column 21/48, head=FixedTextImpl{codePosition=begin line/column 21/48; end line/column 21/48, textBuffer=:}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/49; end line/column 21/49, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 22/1; end line/column 22/3, head=FixedTextImpl{codePosition=begin line/column 22/1; end line/column 22/3, textBuffer=And this is the date of the message:}, tail=PairClouBausteinElementList{codePosition=begin line/column 22/41; end line/column 22/46, head=DynamicValue{codePosition=begin line/column 22/41; end line/column 22/46, name='myDate'}, tail=PairClouBausteinElementList{codePosition=begin line/column 22/49; end line/column 22/54, head=PrintStatement{codePosition=begin line/column 22/49; end line/column 22/54, expression='IdExpression{id='myDate', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 22/55; end line/column 22/55, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 24/11; end line/column 24/17, head=GlobalDeclarationStatement{codePosition=begin line/column 24/11; end line/column 24/17, expression=ClouFunctionCall{codePosition=begin line/column 24/11; end line/column 24/17, functionName='listlen', args=( 'indtext0'  ) }, id='length', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 25/1; end line/column 25/4, head=FixedTextImpl{codePosition=begin line/column 25/1; end line/column 25/4, textBuffer=Now, the length of this list should be 5, and it actually is }, tail=PairClouBausteinElementList{codePosition=begin line/column 25/65; end line/column 25/70, head=PrintStatement{codePosition=begin line/column 25/65; end line/column 25/70, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 25/71; end line/column 25/71, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 26/1; end line/column 26/3, head=FixedTextImpl{codePosition=begin line/column 26/1; end line/column 26/3, textBuffer=And these are the values found in the user data XML:}, tail=PairClouBausteinElementList{codePosition=begin line/column 26/53; end line/column 26/53, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 27/1; end line/column 27/12, head=FixedTextImpl{codePosition=begin line/column 27/1; end line/column 27/12, textBuffer=indtext0[1]= }, tail=PairClouBausteinElementList{codePosition=begin line/column 27/15; end line/column 27/22, head=PrintStatement{codePosition=begin line/column 27/15; end line/column 27/22, expression='IdExpression{id='indtext0', idxExp1=LastExpressionList{codePosition=begin line/column 27/24; end line/column 27/24head='NumExpression{codePosition=begin line/column 27/24; end line/column 27/24, value=1}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 27/26; end line/column 27/26, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 28/1; end line/column 28/12, head=FixedTextImpl{codePosition=begin line/column 28/1; end line/column 28/12, textBuffer=indtext0[2]= }, tail=PairClouBausteinElementList{codePosition=begin line/column 28/15; end line/column 28/22, head=PrintStatement{codePosition=begin line/column 28/15; end line/column 28/22, expression='IdExpression{id='indtext0', idxExp1=LastExpressionList{codePosition=begin line/column 28/24; end line/column 28/24head='NumExpression{codePosition=begin line/column 28/24; end line/column 28/24, value=2}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 28/26; end line/column 28/26, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 29/1; end line/column 29/12, head=FixedTextImpl{codePosition=begin line/column 29/1; end line/column 29/12, textBuffer=indtext0[3]= }, tail=PairClouBausteinElementList{codePosition=begin line/column 29/15; end line/column 29/22, head=PrintStatement{codePosition=begin line/column 29/15; end line/column 29/22, expression='IdExpression{id='indtext0', idxExp1=LastExpressionList{codePosition=begin line/column 29/24; end line/column 29/24head='NumExpression{codePosition=begin line/column 29/24; end line/column 29/24, value=3}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 29/26; end line/column 29/26, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 30/1; end line/column 30/12, head=FixedTextImpl{codePosition=begin line/column 30/1; end line/column 30/12, textBuffer=indtext0[4]= }, tail=PairClouBausteinElementList{codePosition=begin line/column 30/15; end line/column 30/22, head=PrintStatement{codePosition=begin line/column 30/15; end line/column 30/22, expression='IdExpression{id='indtext0', idxExp1=LastExpressionList{codePosition=begin line/column 30/24; end line/column 30/24head='NumExpression{codePosition=begin line/column 30/24; end line/column 30/24, value=4}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 30/26; end line/column 30/26, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 31/1; end line/column 31/12, head=FixedTextImpl{codePosition=begin line/column 31/1; end line/column 31/12, textBuffer=indtext0[5]= }, tail=PairClouBausteinElementList{codePosition=begin line/column 31/15; end line/column 31/22, head=PrintStatement{codePosition=begin line/column 31/15; end line/column 31/22, expression='IdExpression{id='indtext0', idxExp1=LastExpressionList{codePosition=begin line/column 31/24; end line/column 31/24head='NumExpression{codePosition=begin line/column 31/24; end line/column 31/24, value=5}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 31/26; end line/column 31/26, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 32/1; end line/column 32/4, head=FixedTextImpl{codePosition=begin line/column 32/1; end line/column 32/4, textBuffer=grin}, tail=PairClouBausteinElementList{codePosition=begin line/column 33/1; end line/column 33/2, head=HitCommandStatement{codePosition=begin line/column 33/1; end line/column 33/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 33/3; end line/column 33/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 35/1; end line/column 35/3, head=FixedTextImpl{codePosition=begin line/column 35/1; end line/column 35/3, textBuffer=And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 35/11; end line/column 35/15, textBuffer=}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Let's test away with the lelement WHILE-loop szenario!'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, ListDeclaration{listVariableName='indtext0', components='[]'}, DynamicContentReference{name='Global Variable: lelement', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lelement',  'x' ) '}, DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  '' ) '}, DynamicContentReference{name='Global Variable: lastName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lastName',  '' ) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): firstName', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'firstName', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): lastName', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lastName', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): lelement', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lelement', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, WhileLoopFlagValueFlavor{expression=BinaryOperatorExpression{codePosition=begin line/column 16/4; end line/column 16/11, lhs=IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 16/16; end line/column 16/18, value='*'}, value=null}, components=[ListAddItem{listVariableName='indtext0', newValue=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lelement')  ', components='[]'}, DynamicContentReference{name='Assign from Userdata XML (iWL): lelement', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lelement', ./. ) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}]}, Text{name='text', text='This is a message from '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, Text{name='text', text=':'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='And this is the date of the message:'}, DynamicContentReference{name='Assign from Userdata XML (oWL): myDate', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'myDate', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, DynamicContentReference{name='Print: myDate', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'myDate')  '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Global Variable: length', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'indtext0' ) ) '}, Text{name='text', text='Now, the length of this list should be 5, and it actually is '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='And these are the values found in the user data XML:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='indtext0[1]= '}, DynamicContentReference{name='Print: indtext0', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext0', 1)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='indtext0[2]= '}, DynamicContentReference{name='Print: indtext0', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext0', 2)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='indtext0[3]= '}, DynamicContentReference{name='Print: indtext0', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext0', 3)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='indtext0[4]= '}, DynamicContentReference{name='Print: indtext0', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext0', 4)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='indtext0[5]= '}, DynamicContentReference{name='Print: indtext0', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext0', 5)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='grin'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
        workspace.getContent();
    }

    @Test
    public void testWhileLoopForFlavor() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("WhileLoopForFlavor"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        assertNotNull(baustein);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/1; end line/column 5/5, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/1; end line/column 5/5, head=FixedTextImpl{codePosition=begin line/column 5/1; end line/column 5/5, textBuffer=Let's test for-flavored WHILE loops, right away.}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/1; end line/column 6/2, head=HitCommandStatement{codePosition=begin line/column 6/1; end line/column 6/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 6/3; end line/column 6/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/4; end line/column 9/10, head=GlobalListDeclarationStatement{codePosition=begin line/column 9/4; end line/column 9/10, listId='indtext', listExpression=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/16; end line/column 9/21, value='Wont'}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/24; end line/column 9/28, value='see'}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/31; end line/column 9/35, value='the'}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/38; end line/column 9/42, value='end'}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/45; end line/column 9/48, value='of'}, tail=LastExpressionList{codePosition=begin line/column 9/51; end line/column 9/57head='TextExpression{codePosition=begin line/column 9/51; end line/column 9/57, value='this.'}}}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/12; end line/column 10/12, head=GlobalDeclarationStatement{codePosition=begin line/column 10/12; end line/column 10/12, expression=NumExpression{codePosition=begin line/column 10/12; end line/column 10/12, value=1}, id='listind', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 12/4; end line/column 12/10, head=AssignmentStatement{codePosition=begin line/column 12/4; end line/column 12/10, idExpression='IdExpression{id='listind', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=NumExpression{codePosition=begin line/column 12/12; end line/column 12/12, value=1}}, tail=PairClouBausteinElementList{codePosition=begin line/column 14/1; end line/column 14/2, head=WhileStatement{codePosition=begin line/column 14/1; end line/column 14/2, condition=BinaryOperatorExpression{codePosition=begin line/column 14/4; end line/column 14/10, lhs=IdExpression{id='listind', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=LTE, rhs=ClouFunctionCall{codePosition=begin line/column 14/15; end line/column 14/21, functionName='listlen', args=( 'indtext'  ) }, value=null}, whileBody=PairClouBausteinElementList{codePosition=begin line/column 15/8; end line/column 15/14, head=PrintStatement{codePosition=begin line/column 15/8; end line/column 15/14, expression='IdExpression{id='indtext', idxExp1=LastExpressionList{codePosition=begin line/column 15/16; end line/column 15/22head='IdExpression{id='listind', idxExp1=null, idxExp2=null, valueType=null, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 15/24; end line/column 15/24, head=SectionStatement{}, tail=LastClouBausteinElementList{head=AssignmentStatement{codePosition=begin line/column 16/8; end line/column 16/14, idExpression='IdExpression{id='listind', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=BinaryOperatorExpression{codePosition=begin line/column 16/16; end line/column 16/22, lhs=IdExpression{id='listind', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 16/26; end line/column 16/26, value=1}, value=null}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 19/1; end line/column 19/3, head=FixedTextImpl{codePosition=begin line/column 19/1; end line/column 19/3, textBuffer=And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 19/11; end line/column 19/15, textBuffer=}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Let's test for-flavored WHILE loops, right away.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, ListDeclaration{listVariableName='indtext', components='[]'}, ListAddItem{listVariableName='indtext', newValue=' 'Wont' ', components='[]'}, ListAddItem{listVariableName='indtext', newValue=' 'see' ', components='[]'}, ListAddItem{listVariableName='indtext', newValue=' 'the' ', components='[]'}, ListAddItem{listVariableName='indtext', newValue=' 'end' ', components='[]'}, ListAddItem{listVariableName='indtext', newValue=' 'of' ', components='[]'}, ListAddItem{listVariableName='indtext', newValue=' 'this.' ', components='[]'}, DynamicContentReference{name='Global Variable: listind', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'listind', 1) '}, DynamicContentReference{name='Scalar Assignment: listind', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'listind', 1 )'}, ForLoop{expression=BinaryOperatorExpression{codePosition=begin line/column 0/0; end line/column 0/0, lhs=NumExpression{codePosition=begin line/column 0/0; end line/column 0/0, value=1}, operator=PLUS, rhs=BinaryOperatorExpression{codePosition=begin line/column 0/0; end line/column 0/0, lhs=ClouFunctionCall{codePosition=begin line/column 14/15; end line/column 14/21, functionName='listlen', args=( 'indtext'  ) }, operator=MINUS, rhs=IdExpression{id='listind', idxExp1=null, idxExp2=null, valueType=null, value=null}, value=null}, value=null}, components=[DynamicContentReference{name='Print: indtext', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext',  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'listind')  )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: listind', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'listind', ( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'listind')   + 1) )'}]}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
        workspace.getContent();
    }

    @Test
    public void testListDeclarationFromList() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("ListDeclarationFromList"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        assertNotNull(baustein);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 4/11; end line/column 4/11, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 4/11; end line/column 4/11, head=GlobalDeclarationStatement{codePosition=begin line/column 4/11; end line/column 4/11, expression=NumExpression{codePosition=begin line/column 4/11; end line/column 4/11, value=0}, id='length', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 5/12; end line/column 5/12, head=GlobalDeclarationStatement{codePosition=begin line/column 5/12; end line/column 5/12, expression=NumExpression{codePosition=begin line/column 5/12; end line/column 5/12, value=1}, id='counter', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/1; end line/column 7/12, head=FixedTextImpl{codePosition=begin line/column 7/1; end line/column 7/12, textBuffer=Initializing liste99 D { 1, 2, 3, 4, 5 }}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/42; end line/column 7/42, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/4; end line/column 8/10, head=GlobalListDeclarationStatement{codePosition=begin line/column 8/4; end line/column 8/10, listId='liste99', listExpression=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/16; end line/column 8/16, value=1}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/19; end line/column 8/19, value=2}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/22; end line/column 8/22, value=3}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/25; end line/column 8/25, value=4}, tail=LastExpressionList{codePosition=begin line/column 8/28; end line/column 8/28head='NumExpression{codePosition=begin line/column 8/28; end line/column 8/28, value=5}}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/4; end line/column 9/9, head=AssignmentStatement{codePosition=begin line/column 9/4; end line/column 9/9, idExpression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=ClouFunctionCall{codePosition=begin line/column 9/11; end line/column 9/17, functionName='listlen', args=( 'liste99'  ) }}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/1; end line/column 10/7, head=FixedTextImpl{codePosition=begin line/column 10/1; end line/column 10/7, textBuffer=liste99 should have 5 elements, and in fact it has these }, tail=PairClouBausteinElementList{codePosition=begin line/column 10/61; end line/column 10/66, head=PrintStatement{codePosition=begin line/column 10/61; end line/column 10/66, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/68; end line/column 10/76, head=FixedTextImpl{codePosition=begin line/column 10/68; end line/column 10/76, textBuffer= elements:}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/77; end line/column 10/77, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 11/4; end line/column 11/10, head=AssignmentStatement{codePosition=begin line/column 11/4; end line/column 11/10, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=NumExpression{codePosition=begin line/column 11/12; end line/column 11/12, value=1}}, tail=PairClouBausteinElementList{codePosition=begin line/column 12/4; end line/column 12/9, head=ForStatement{repetitionCount=IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}, forBody=PairClouBausteinElementList{codePosition=begin line/column 13/8; end line/column 13/14, head=PrintStatement{codePosition=begin line/column 13/8; end line/column 13/14, expression='IdExpression{id='liste99', idxExp1=LastExpressionList{codePosition=begin line/column 13/16; end line/column 13/22head='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 13/24; end line/column 13/24, head=SectionStatement{}, tail=LastClouBausteinElementList{head=AssignmentStatement{codePosition=begin line/column 14/8; end line/column 14/14, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=BinaryOperatorExpression{codePosition=begin line/column 14/16; end line/column 14/22, lhs=IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 14/26; end line/column 14/26, value=1}, value=null}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/1; end line/column 17/12, head=FixedTextImpl{codePosition=begin line/column 17/1; end line/column 17/12, textBuffer=Initializing liste98 d { \"Hello, \", \"World!\", \" argl \" }}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/57; end line/column 17/57, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 18/4; end line/column 18/10, head=LocalListDeclarationStatement{codePosition=begin line/column 18/4; end line/column 18/10listId='liste98', listExpression=PairExpressionList{head=TextExpression{codePosition=begin line/column 18/16; end line/column 18/24, value='Hello, '}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 18/27; end line/column 18/34, value='World!'}, tail=LastExpressionList{codePosition=begin line/column 18/37; end line/column 18/44head='TextExpression{codePosition=begin line/column 18/37; end line/column 18/44, value=' argl '}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 19/4; end line/column 19/9, head=AssignmentStatement{codePosition=begin line/column 19/4; end line/column 19/9, idExpression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=ClouFunctionCall{codePosition=begin line/column 19/11; end line/column 19/17, functionName='listlen', args=( 'liste98'  ) }}, tail=PairClouBausteinElementList{codePosition=begin line/column 20/1; end line/column 20/7, head=FixedTextImpl{codePosition=begin line/column 20/1; end line/column 20/7, textBuffer=liste98 should have 3 elements, and in fact it has these }, tail=PairClouBausteinElementList{codePosition=begin line/column 20/61; end line/column 20/66, head=PrintStatement{codePosition=begin line/column 20/61; end line/column 20/66, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 20/68; end line/column 20/76, head=FixedTextImpl{codePosition=begin line/column 20/68; end line/column 20/76, textBuffer= elements:}, tail=PairClouBausteinElementList{codePosition=begin line/column 20/77; end line/column 20/77, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/4; end line/column 21/10, head=AssignmentStatement{codePosition=begin line/column 21/4; end line/column 21/10, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=NumExpression{codePosition=begin line/column 21/12; end line/column 21/12, value=1}}, tail=PairClouBausteinElementList{codePosition=begin line/column 22/4; end line/column 22/9, head=ForStatement{repetitionCount=IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}, forBody=PairClouBausteinElementList{codePosition=begin line/column 23/8; end line/column 23/14, head=PrintStatement{codePosition=begin line/column 23/8; end line/column 23/14, expression='IdExpression{id='liste98', idxExp1=LastExpressionList{codePosition=begin line/column 23/16; end line/column 23/22head='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 23/24; end line/column 23/24, head=SectionStatement{}, tail=LastClouBausteinElementList{head=AssignmentStatement{codePosition=begin line/column 24/8; end line/column 24/14, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=BinaryOperatorExpression{codePosition=begin line/column 24/16; end line/column 24/22, lhs=IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 24/26; end line/column 24/26, value=1}, value=null}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 30/1; end line/column 30/12, head=FixedTextImpl{codePosition=begin line/column 30/1; end line/column 30/12, textBuffer=Initializing listFromList D liste99}, tail=PairClouBausteinElementList{codePosition=begin line/column 31/4; end line/column 31/15, head=GlobalListDeclarationStatement{codePosition=begin line/column 31/4; end line/column 31/15, listId='listFromList', listExpression=IdExpression{id='liste99', idxExp1=null, idxExp2=null, valueType=null, value=null}}, tail=PairClouBausteinElementList{codePosition=begin line/column 32/4; end line/column 32/9, head=AssignmentStatement{codePosition=begin line/column 32/4; end line/column 32/9, idExpression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=ClouFunctionCall{codePosition=begin line/column 32/11; end line/column 32/17, functionName='listlen', args=( 'listFromList'  ) }}, tail=PairClouBausteinElementList{codePosition=begin line/column 33/1; end line/column 33/12, head=FixedTextImpl{codePosition=begin line/column 33/1; end line/column 33/12, textBuffer=listFromList should have 5 elements, and in fact it has these }, tail=PairClouBausteinElementList{codePosition=begin line/column 33/66; end line/column 33/71, head=PrintStatement{codePosition=begin line/column 33/66; end line/column 33/71, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 33/73; end line/column 33/81, head=FixedTextImpl{codePosition=begin line/column 33/73; end line/column 33/81, textBuffer= elements:}, tail=PairClouBausteinElementList{codePosition=begin line/column 33/82; end line/column 33/82, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 34/4; end line/column 34/10, head=AssignmentStatement{codePosition=begin line/column 34/4; end line/column 34/10, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=NumExpression{codePosition=begin line/column 34/12; end line/column 34/12, value=1}}, tail=PairClouBausteinElementList{codePosition=begin line/column 35/4; end line/column 35/9, head=ForStatement{repetitionCount=IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}, forBody=PairClouBausteinElementList{codePosition=begin line/column 36/8; end line/column 36/19, head=PrintStatement{codePosition=begin line/column 36/8; end line/column 36/19, expression='IdExpression{id='listFromList', idxExp1=LastExpressionList{codePosition=begin line/column 36/21; end line/column 36/27head='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 36/29; end line/column 36/29, head=SectionStatement{}, tail=LastClouBausteinElementList{head=AssignmentStatement{codePosition=begin line/column 37/8; end line/column 37/14, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=BinaryOperatorExpression{codePosition=begin line/column 37/16; end line/column 37/22, lhs=IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 37/26; end line/column 37/26, value=1}, value=null}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 40/1; end line/column 40/3, head=FixedTextImpl{codePosition=begin line/column 40/1; end line/column 40/3, textBuffer=And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 40/11; end line/column 40/15, textBuffer=}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[DynamicContentReference{name='Global Variable: length', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'length', 0) '}, DynamicContentReference{name='Global Variable: counter', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'counter', 1) '}, Text{name='text', text='Initializing liste99 D { 1, 2, 3, 4, 5 }'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, ListDeclaration{listVariableName='liste99', components='[]'}, ListAddItem{listVariableName='liste99', newValue='1', components='[]'}, ListAddItem{listVariableName='liste99', newValue='2', components='[]'}, ListAddItem{listVariableName='liste99', newValue='3', components='[]'}, ListAddItem{listVariableName='liste99', newValue='4', components='[]'}, ListAddItem{listVariableName='liste99', newValue='5', components='[]'}, DynamicContentReference{name='Scalar Assignment: length', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'liste99' )  )'}, Text{name='text', text='liste99 should have 5 elements, and in fact it has these '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, Text{name='text', text=' elements:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', 1 )'}, ForLoop{expression=IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}, components=[DynamicContentReference{name='Print: liste99', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'liste99',  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')  )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', ( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')   + 1) )'}]}, Text{name='text', text='Initializing liste98 d { \"Hello, \", \"World!\", \" argl \" }'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, ListDeclaration{listVariableName='liste98', components='[]'}, ListAddItem{listVariableName='liste98', newValue=' 'Hello, ' ', components='[]'}, ListAddItem{listVariableName='liste98', newValue=' 'World!' ', components='[]'}, ListAddItem{listVariableName='liste98', newValue=' ' argl ' ', components='[]'}, DynamicContentReference{name='Scalar Assignment: length', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'liste98' )  )'}, Text{name='text', text='liste98 should have 3 elements, and in fact it has these '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, Text{name='text', text=' elements:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', 1 )'}, ForLoop{expression=IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}, components=[DynamicContentReference{name='Print: liste98', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'liste98',  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')  )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', ( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')   + 1) )'}]}, Text{name='text', text='Initializing listFromList D liste99'}, ListDeclaration{listVariableName='listFromList', components='[]'}, DynamicContentReference{name='Append List liste99 to listFromList', xpath=' hit2assext:appendList(var:read('renderSessionUuid'), 'liste99', 'listFromList') '}, DynamicContentReference{name='Scalar Assignment: length', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'listFromList' )  )'}, Text{name='text', text='listFromList should have 5 elements, and in fact it has these '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, Text{name='text', text=' elements:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', 1 )'}, ForLoop{expression=IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}, components=[DynamicContentReference{name='Print: listFromList', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'listFromList',  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')  )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', ( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')   + 1) )'}]}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
        workspace.getContent();
    }

    @Test
    public void testWhileAndFor() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("WhileAndFor"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        assertNotNull(baustein);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/1; end line/column 5/5, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/1; end line/column 5/5, head=FixedTextImpl{codePosition=begin line/column 5/1; end line/column 5/5, textBuffer=Let's test away with the lelement WHILE-loop szenario!}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/1; end line/column 6/2, head=HitCommandStatement{codePosition=begin line/column 6/1; end line/column 6/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 6/3; end line/column 6/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/4; end line/column 7/11, head=GlobalListDeclarationStatement{codePosition=begin line/column 7/4; end line/column 7/11, listId='indtext0', listExpression=null}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/13; end line/column 8/15, head=GlobalDeclarationStatement{codePosition=begin line/column 8/13; end line/column 8/15, expression=TextExpression{codePosition=begin line/column 8/13; end line/column 8/15, value='x'}, id='lelement', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/14; end line/column 10/15, head=GlobalDeclarationStatement{codePosition=begin line/column 10/14; end line/column 10/15, expression=TextExpression{codePosition=begin line/column 10/14; end line/column 10/15, value=''}, id='firstName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 11/13; end line/column 11/14, head=GlobalDeclarationStatement{codePosition=begin line/column 11/13; end line/column 11/14, expression=TextExpression{codePosition=begin line/column 11/13; end line/column 11/14, value=''}, id='lastName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 13/5; end line/column 13/13, head=DynamicValue{codePosition=begin line/column 13/5; end line/column 13/13, name='firstName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 14/5; end line/column 14/12, head=DynamicValue{codePosition=begin line/column 14/5; end line/column 14/12, name='lastName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/1; end line/column 16/5, head=FixedTextImpl{codePosition=begin line/column 16/1; end line/column 16/5, textBuffer=Hello }, tail=PairClouBausteinElementList{codePosition=begin line/column 16/10; end line/column 16/18, head=PrintStatement{codePosition=begin line/column 16/10; end line/column 16/18, expression='IdExpression{id='firstName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 16/23; end line/column 16/30, head=PrintStatement{codePosition=begin line/column 16/23; end line/column 16/30, expression='IdExpression{id='lastName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/31; end line/column 16/31, head=FixedTextImpl{codePosition=begin line/column 16/31; end line/column 16/31, textBuffer=,}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/32; end line/column 16/32, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/1; end line/column 17/4, head=FixedTextImpl{codePosition=begin line/column 17/1; end line/column 17/4, textBuffer=here comes your list:}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/22; end line/column 17/22, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/23; end line/column 17/23, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 18/5; end line/column 18/12, head=DynamicValue{codePosition=begin line/column 18/5; end line/column 18/12, name='lelement'}, tail=PairClouBausteinElementList{codePosition=begin line/column 19/1; end line/column 19/2, head=WhileStatement{codePosition=begin line/column 19/1; end line/column 19/2, condition=BinaryOperatorExpression{codePosition=begin line/column 19/4; end line/column 19/11, lhs=IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 19/16; end line/column 19/18, value='*'}, value=null}, whileBody=PairClouBausteinElementList{codePosition=begin line/column 20/8; end line/column 20/15, head=ListConcatenationStatement{codePosition=begin line/column 20/8; end line/column 20/15listId='indtext0', listExpression=LastExpressionList{codePosition=begin line/column 20/21; end line/column 20/28head='IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}}}, tail=LastClouBausteinElementList{head=DynamicValue{codePosition=begin line/column 21/9; end line/column 21/16, name='lelement'}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 24/12; end line/column 24/12, head=GlobalDeclarationStatement{codePosition=begin line/column 24/12; end line/column 24/12, expression=NumExpression{codePosition=begin line/column 24/12; end line/column 24/12, value=1}, id='counter', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 25/4; end line/column 25/10, head=ForStatement{repetitionCount=ClouFunctionCall{codePosition=begin line/column 25/4; end line/column 25/10, functionName='listlen', args=( 'indtext0'  ) }, forBody=PairClouBausteinElementList{codePosition=begin line/column 26/8; end line/column 26/15, head=PrintStatement{codePosition=begin line/column 26/8; end line/column 26/15, expression='IdExpression{id='indtext0', idxExp1=LastExpressionList{codePosition=begin line/column 26/17; end line/column 26/23head='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 27/8; end line/column 27/14, head=AssignmentStatement{codePosition=begin line/column 27/8; end line/column 27/14, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=BinaryOperatorExpression{codePosition=begin line/column 27/16; end line/column 27/22, lhs=IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 27/26; end line/column 27/26, value=1}, value=null}}, tail=LastClouBausteinElementList{head=SectionStatement{}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 30/1; end line/column 30/3, head=FixedTextImpl{codePosition=begin line/column 30/1; end line/column 30/3, textBuffer=And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 30/11; end line/column 30/15, textBuffer=}}}}}}}}}}}}}}}}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Let's test away with the lelement WHILE-loop szenario!'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, ListDeclaration{listVariableName='indtext0', components='[]'}, DynamicContentReference{name='Global Variable: lelement', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lelement',  'x' ) '}, DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  '' ) '}, DynamicContentReference{name='Global Variable: lastName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lastName',  '' ) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): firstName', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'firstName', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): lastName', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lastName', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, Text{name='text', text='Hello '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, Text{name='text', text=','}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='here comes your list:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Assign from Userdata XML (oWL): lelement', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lelement', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, WhileLoopFlagValueFlavor{expression=BinaryOperatorExpression{codePosition=begin line/column 19/4; end line/column 19/11, lhs=IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 19/16; end line/column 19/18, value='*'}, value=null}, components=[ListAddItem{listVariableName='indtext0', newValue=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lelement')  ', components='[]'}, DynamicContentReference{name='Assign from Userdata XML (iWL): lelement', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lelement', ./. ) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}]}, DynamicContentReference{name='Global Variable: counter', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'counter', 1) '}, ForLoop{expression=ClouFunctionCall{codePosition=begin line/column 25/4; end line/column 25/10, functionName='listlen', args=( 'indtext0'  ) }, components=[DynamicContentReference{name='Print: indtext0', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'indtext0',  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')  )'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', ( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')   + 1) )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
        workspace.getContent();
    }

    @Test
    public void testListLength() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("ListLength"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        assertNotNull(baustein);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/1; end line/column 5/5, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/1; end line/column 5/5, head=FixedTextImpl{codePosition=begin line/column 5/1; end line/column 5/5, textBuffer=Let's test away with the listlen standard function!}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/1; end line/column 6/2, head=HitCommandStatement{codePosition=begin line/column 6/1; end line/column 6/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 6/3; end line/column 6/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/4; end line/column 7/11, head=GlobalListDeclarationStatement{codePosition=begin line/column 7/4; end line/column 7/11, listId='indtext0', listExpression=null}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/13; end line/column 8/15, head=GlobalDeclarationStatement{codePosition=begin line/column 8/13; end line/column 8/15, expression=TextExpression{codePosition=begin line/column 8/13; end line/column 8/15, value='x'}, id='lelement', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/14; end line/column 10/15, head=GlobalDeclarationStatement{codePosition=begin line/column 10/14; end line/column 10/15, expression=TextExpression{codePosition=begin line/column 10/14; end line/column 10/15, value=''}, id='firstName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 11/13; end line/column 11/14, head=GlobalDeclarationStatement{codePosition=begin line/column 11/13; end line/column 11/14, expression=TextExpression{codePosition=begin line/column 11/13; end line/column 11/14, value=''}, id='lastName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 13/5; end line/column 13/13, head=DynamicValue{codePosition=begin line/column 13/5; end line/column 13/13, name='firstName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 14/5; end line/column 14/12, head=DynamicValue{codePosition=begin line/column 14/5; end line/column 14/12, name='lastName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/1; end line/column 16/3, head=FixedTextImpl{codePosition=begin line/column 16/1; end line/column 16/3, textBuffer=The first name was read to be }, tail=PairClouBausteinElementList{codePosition=begin line/column 16/34; end line/column 16/42, head=PrintStatement{codePosition=begin line/column 16/34; end line/column 16/42, expression='IdExpression{id='firstName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/43; end line/column 16/43, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/1; end line/column 17/3, head=FixedTextImpl{codePosition=begin line/column 17/1; end line/column 17/3, textBuffer=The last name was read to be }, tail=PairClouBausteinElementList{codePosition=begin line/column 17/33; end line/column 17/40, head=PrintStatement{codePosition=begin line/column 17/33; end line/column 17/40, expression='IdExpression{id='lastName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/41; end line/column 17/41, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 18/1; end line/column 18/3, head=FixedTextImpl{codePosition=begin line/column 18/1; end line/column 18/3, textBuffer=Now comes the loop :-)}, tail=PairClouBausteinElementList{codePosition=begin line/column 18/23; end line/column 18/23, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 20/5; end line/column 20/12, head=DynamicValue{codePosition=begin line/column 20/5; end line/column 20/12, name='lelement'}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/1; end line/column 21/2, head=WhileStatement{codePosition=begin line/column 21/1; end line/column 21/2, condition=BinaryOperatorExpression{codePosition=begin line/column 21/4; end line/column 21/11, lhs=IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 21/16; end line/column 21/18, value='*'}, value=null}, whileBody=PairClouBausteinElementList{codePosition=begin line/column 22/8; end line/column 22/15, head=ListConcatenationStatement{codePosition=begin line/column 22/8; end line/column 22/15listId='indtext0', listExpression=LastExpressionList{codePosition=begin line/column 22/21; end line/column 22/28head='IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}}}, tail=LastClouBausteinElementList{head=DynamicValue{codePosition=begin line/column 23/9; end line/column 23/16, name='lelement'}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 26/11; end line/column 26/17, head=GlobalDeclarationStatement{codePosition=begin line/column 26/11; end line/column 26/17, expression=ClouFunctionCall{codePosition=begin line/column 26/11; end line/column 26/17, functionName='listlen', args=( 'indtext0'  ) }, id='length', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 27/1; end line/column 27/4, head=FixedTextImpl{codePosition=begin line/column 27/1; end line/column 27/4, textBuffer=Now, the length of this list should be 5, and actually, it is }, tail=PairClouBausteinElementList{codePosition=begin line/column 27/66; end line/column 27/71, head=PrintStatement{codePosition=begin line/column 27/66; end line/column 27/71, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 27/72; end line/column 27/72, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 28/4; end line/column 28/10, head=ConditionalStatement{codePosition=begin line/column 28/4; end line/column 28/10, condition=BinaryOperatorExpression{codePosition=begin line/column 28/4; end line/column 28/10, lhs=ClouFunctionCall{codePosition=begin line/column 28/4; end line/column 28/10, functionName='listlen', args=( 'indtext0'  ) }, operator=EQ, rhs=NumExpression{codePosition=begin line/column 28/26; end line/column 28/26, value=5}, value=null}, thenElement=PairClouBausteinElementList{codePosition=begin line/column 30/9; end line/column 30/10, head=FixedTextImpl{codePosition=begin line/column 30/9; end line/column 30/10, textBuffer=Na wunderbar, das hat geklappt.}, tail=LastClouBausteinElementList{head=SectionStatement{}}}, elseElement=PairClouBausteinElementList{codePosition=begin line/column 32/9; end line/column 32/12, head=FixedTextImpl{codePosition=begin line/column 32/9; end line/column 32/12, textBuffer=Hmm, da funktioniert noch etwas nicht. Probiert weiter.}, tail=LastClouBausteinElementList{head=SectionStatement{}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 34/1; end line/column 34/3, head=FixedTextImpl{codePosition=begin line/column 34/1; end line/column 34/3, textBuffer=End so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 34/11; end line/column 34/15, textBuffer=}}}}}}}}}}}}}}}}}}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Let's test away with the listlen standard function!'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, ListDeclaration{listVariableName='indtext0', components='[]'}, DynamicContentReference{name='Global Variable: lelement', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lelement',  'x' ) '}, DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  '' ) '}, DynamicContentReference{name='Global Variable: lastName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lastName',  '' ) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): firstName', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'firstName', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, DynamicContentReference{name='Assign from Userdata XML (oWL): lastName', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lastName', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, Text{name='text', text='The first name was read to be '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='The last name was read to be '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Now comes the loop :-)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Assign from Userdata XML (oWL): lelement', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lelement', /UserData/payload/line[@lineNr = hit2assext:getXmlSequence(var:read('renderSessionUuid'))]) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}, WhileLoopFlagValueFlavor{expression=BinaryOperatorExpression{codePosition=begin line/column 21/4; end line/column 21/11, lhs=IdExpression{id='lelement', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 21/16; end line/column 21/18, value='*'}, value=null}, components=[ListAddItem{listVariableName='indtext0', newValue=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lelement')  ', components='[]'}, DynamicContentReference{name='Assign from Userdata XML (iWL): lelement', xpath=' hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'lelement', ./. ) | hit2assext:incrementXmlSequence(var:read('renderSessionUuid')) '}]}, DynamicContentReference{name='Global Variable: length', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'indtext0' ) ) '}, Text{name='text', text='Now, the length of this list should be 5, and actually, it is '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, IfThenElseParagraph{condition=BinaryOperatorExpression{codePosition=begin line/column 28/4; end line/column 28/10, lhs=ClouFunctionCall{codePosition=begin line/column 28/4; end line/column 28/10, functionName='listlen', args=( 'indtext0'  ) }, operator=EQ, rhs=NumExpression{codePosition=begin line/column 28/26; end line/column 28/26, value=5}, value=null}, components=[IfThenParagraph{components=[Text{name='text', text='Na wunderbar, das hat geklappt.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}, IfElseParagraph{components=[Text{name='text', text='Hmm, da funktioniert noch etwas nicht. Probiert weiter.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}]}, Text{name='text', text='End so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testListConcatenation() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("ListConcatenation"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        assertNotNull(baustein);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 4/14; end line/column 4/19, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 4/14; end line/column 4/19, head=GlobalDeclarationStatement{codePosition=begin line/column 4/14; end line/column 4/19, expression=TextExpression{codePosition=begin line/column 4/14; end line/column 4/19, value='John'}, id='firstName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 5/13; end line/column 5/20, head=GlobalDeclarationStatement{codePosition=begin line/column 5/13; end line/column 5/20, expression=TextExpression{codePosition=begin line/column 5/13; end line/column 5/20, value='Connor'}, id='lastName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/1; end line/column 7/4, head=FixedTextImpl{codePosition=begin line/column 7/1; end line/column 7/4, textBuffer=This is some fixed text for you.}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/4; end line/column 8/10, head=GlobalListDeclarationStatement{codePosition=begin line/column 8/4; end line/column 8/10, listId='liste99', listExpression=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/16; end line/column 8/16, value=1}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/19; end line/column 8/19, value=2}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/22; end line/column 8/22, value=3}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 8/25; end line/column 8/25, value=4}, tail=LastExpressionList{codePosition=begin line/column 8/28; end line/column 8/28head='NumExpression{codePosition=begin line/column 8/28; end line/column 8/28, value=5}}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/4; end line/column 9/10, head=GlobalListDeclarationStatement{codePosition=begin line/column 9/4; end line/column 9/10, listId='liste98', listExpression=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/16; end line/column 9/20, value='Die'}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 9/23; end line/column 9/29, value='fiend'}, tail=LastExpressionList{codePosition=begin line/column 9/32; end line/column 9/36head='TextExpression{codePosition=begin line/column 9/32; end line/column 9/36, value='die'}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/4; end line/column 10/10, head=GlobalListDeclarationStatement{codePosition=begin line/column 10/4; end line/column 10/10, listId='liste97', listExpression=BinaryOperatorExpression{codePosition=begin line/column 10/16; end line/column 10/24, lhs=LastExpressionList{codePosition=begin line/column 10/16; end line/column 10/24head='TextExpression{codePosition=begin line/column 10/16; end line/column 10/24, value='Horrido'}}, operator=AND, rhs=BinaryOperatorExpression{codePosition=begin line/column 10/32; end line/column 10/36, lhs=PairExpressionList{head=TextExpression{codePosition=begin line/column 10/32; end line/column 10/36, value='auf'}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 10/39; end line/column 10/43, value='und'}, tail=LastExpressionList{codePosition=begin line/column 10/46; end line/column 10/50head='TextExpression{codePosition=begin line/column 10/46; end line/column 10/50, value='der'}}}}, operator=AND, rhs=BinaryOperatorExpression{codePosition=begin line/column 10/58; end line/column 10/62, lhs=PairExpressionList{head=TextExpression{codePosition=begin line/column 10/58; end line/column 10/62, value='Gas'}, tail=LastExpressionList{codePosition=begin line/column 10/65; end line/column 10/70head='TextExpression{codePosition=begin line/column 10/65; end line/column 10/70, value='nach'}}}, operator=AND, rhs=PairExpressionList{head=NumExpression{codePosition=begin line/column 10/78; end line/column 10/78, value=1}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 10/81; end line/column 10/81, value=2}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 10/84; end line/column 10/84, value=3}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 10/87; end line/column 10/87, value=4}, tail=LastExpressionList{codePosition=begin line/column 10/90; end line/column 10/90head='NumExpression{codePosition=begin line/column 10/90; end line/column 10/90, value=5}}}}}}, value=null}, value=null}, value=null}}, tail=PairClouBausteinElementList{codePosition=begin line/column 11/4; end line/column 11/10, head=ListConcatenationStatement{codePosition=begin line/column 11/4; end line/column 11/10listId='liste97', listExpression=BinaryOperatorExpression{codePosition=begin line/column 11/14; end line/column 11/20, lhs=IdExpression{id='liste98', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=AND, rhs=BinaryOperatorExpression{codePosition=begin line/column 11/24; end line/column 11/30, lhs=IdExpression{id='liste99', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=AND, rhs=BinaryOperatorExpression{codePosition=begin line/column 11/36; end line/column 11/37, lhs=PairExpressionList{head=NumExpression{codePosition=begin line/column 11/36; end line/column 11/37, value=99}, tail=LastExpressionList{codePosition=begin line/column 11/40; end line/column 11/41head='NumExpression{codePosition=begin line/column 11/40; end line/column 11/41, value=98}}}, operator=AND, rhs=PairExpressionList{head=NumExpression{codePosition=begin line/column 11/49; end line/column 11/50, value=96}, tail=LastExpressionList{codePosition=begin line/column 11/53; end line/column 11/54head='NumExpression{codePosition=begin line/column 11/53; end line/column 11/54, value=30}}}, value=null}, value=null}, value=null}}, tail=PairClouBausteinElementList{codePosition=begin line/column 13/1; end line/column 13/2, head=HitCommandStatement{codePosition=begin line/column 13/1; end line/column 13/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 13/3; end line/column 13/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 14/1; end line/column 14/5, head=FixedTextImpl{codePosition=begin line/column 14/1; end line/column 14/5, textBuffer=Hello }, tail=PairClouBausteinElementList{codePosition=begin line/column 14/10; end line/column 14/18, head=PrintStatement{codePosition=begin line/column 14/10; end line/column 14/18, expression='IdExpression{id='firstName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 14/23; end line/column 14/30, head=PrintStatement{codePosition=begin line/column 14/23; end line/column 14/30, expression='IdExpression{id='lastName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 14/31; end line/column 14/31, head=FixedTextImpl{codePosition=begin line/column 14/31; end line/column 14/31, textBuffer=,}, tail=PairClouBausteinElementList{codePosition=begin line/column 15/1; end line/column 15/2, head=HitCommandStatement{codePosition=begin line/column 15/1; end line/column 15/2, hitCommand=RETURN, repetitor=null, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/1; end line/column 16/5, head=FixedTextImpl{codePosition=begin line/column 16/1; end line/column 16/5, textBuffer=Hello }, tail=PairClouBausteinElementList{codePosition=begin line/column 16/10; end line/column 16/18, head=PrintStatement{codePosition=begin line/column 16/10; end line/column 16/18, expression='IdExpression{id='firstName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 16/23; end line/column 16/30, head=PrintStatement{codePosition=begin line/column 16/23; end line/column 16/30, expression='IdExpression{id='lastName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 16/31; end line/column 16/31, head=FixedTextImpl{codePosition=begin line/column 16/31; end line/column 16/31, textBuffer=!}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/1; end line/column 17/2, head=HitCommandStatement{codePosition=begin line/column 17/1; end line/column 17/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 17/3; end line/column 17/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 18/4; end line/column 18/10, head=PrintStatement{codePosition=begin line/column 18/4; end line/column 18/10, expression='IdExpression{id='liste98', idxExp1=LastExpressionList{codePosition=begin line/column 18/12; end line/column 18/12head='NumExpression{codePosition=begin line/column 18/12; end line/column 18/12, value=1}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 18/18; end line/column 18/24, head=PrintStatement{codePosition=begin line/column 18/18; end line/column 18/24, expression='IdExpression{id='liste98', idxExp1=LastExpressionList{codePosition=begin line/column 18/26; end line/column 18/26head='NumExpression{codePosition=begin line/column 18/26; end line/column 18/26, value=2}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 18/32; end line/column 18/38, head=PrintStatement{codePosition=begin line/column 18/32; end line/column 18/38, expression='IdExpression{id='liste98', idxExp1=LastExpressionList{codePosition=begin line/column 18/40; end line/column 18/40head='NumExpression{codePosition=begin line/column 18/40; end line/column 18/40, value=3}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 19/1; end line/column 19/2, head=HitCommandStatement{codePosition=begin line/column 19/1; end line/column 19/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 19/3; end line/column 19/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 20/11; end line/column 20/17, head=GlobalDeclarationStatement{codePosition=begin line/column 20/11; end line/column 20/17, expression=ClouFunctionCall{codePosition=begin line/column 20/11; end line/column 20/17, functionName='listlen', args=( 'liste99'  ) }, id='length', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/1; end line/column 21/7, head=FixedTextImpl{codePosition=begin line/column 21/1; end line/column 21/7, textBuffer=liste99 should have 5 elements, and actually it has }, tail=PairClouBausteinElementList{codePosition=begin line/column 21/56; end line/column 21/61, head=PrintStatement{codePosition=begin line/column 21/56; end line/column 21/61, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/63; end line/column 21/71, head=FixedTextImpl{codePosition=begin line/column 21/63; end line/column 21/71, textBuffer= elements.}, tail=PairClouBausteinElementList{codePosition=begin line/column 21/72; end line/column 21/72, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 22/4; end line/column 22/9, head=AssignmentStatement{codePosition=begin line/column 22/4; end line/column 22/9, idExpression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=ClouFunctionCall{codePosition=begin line/column 22/11; end line/column 22/17, functionName='listlen', args=( 'liste98'  ) }}, tail=PairClouBausteinElementList{codePosition=begin line/column 23/1; end line/column 23/7, head=FixedTextImpl{codePosition=begin line/column 23/1; end line/column 23/7, textBuffer=liste98 should have 3 elements, and actually it has }, tail=PairClouBausteinElementList{codePosition=begin line/column 23/56; end line/column 23/61, head=PrintStatement{codePosition=begin line/column 23/56; end line/column 23/61, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 23/63; end line/column 23/71, head=FixedTextImpl{codePosition=begin line/column 23/63; end line/column 23/71, textBuffer= elements.}, tail=PairClouBausteinElementList{codePosition=begin line/column 23/72; end line/column 23/72, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 24/4; end line/column 24/9, head=AssignmentStatement{codePosition=begin line/column 24/4; end line/column 24/9, idExpression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=ClouFunctionCall{codePosition=begin line/column 24/11; end line/column 24/17, functionName='listlen', args=( 'liste97'  ) }}, tail=PairClouBausteinElementList{codePosition=begin line/column 25/1; end line/column 25/7, head=FixedTextImpl{codePosition=begin line/column 25/1; end line/column 25/7, textBuffer=liste97 should have 23 elements, and actually it has }, tail=PairClouBausteinElementList{codePosition=begin line/column 25/57; end line/column 25/62, head=PrintStatement{codePosition=begin line/column 25/57; end line/column 25/62, expression='IdExpression{id='length', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 25/64; end line/column 25/72, head=FixedTextImpl{codePosition=begin line/column 25/64; end line/column 25/72, textBuffer= elements.}, tail=PairClouBausteinElementList{codePosition=begin line/column 25/73; end line/column 25/73, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 26/1; end line/column 26/3, head=FixedTextImpl{codePosition=begin line/column 26/1; end line/column 26/3, textBuffer=And these are the items of liste97:}, tail=PairClouBausteinElementList{codePosition=begin line/column 26/36; end line/column 26/36, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 27/12; end line/column 27/12, head=GlobalDeclarationStatement{codePosition=begin line/column 27/12; end line/column 27/12, expression=NumExpression{codePosition=begin line/column 27/12; end line/column 27/12, value=1}, id='counter', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 28/4; end line/column 28/10, head=ForStatement{repetitionCount=ClouFunctionCall{codePosition=begin line/column 28/4; end line/column 28/10, functionName='listlen', args=( 'liste97'  ) }, forBody=PairClouBausteinElementList{codePosition=begin line/column 29/7; end line/column 29/13, head=PrintStatement{codePosition=begin line/column 29/7; end line/column 29/13, expression='IdExpression{id='liste97', idxExp1=LastExpressionList{codePosition=begin line/column 29/15; end line/column 29/21head='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 29/23; end line/column 29/23, head=SectionStatement{}, tail=LastClouBausteinElementList{head=AssignmentStatement{codePosition=begin line/column 30/7; end line/column 30/13, idExpression='IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}', expression=BinaryOperatorExpression{codePosition=begin line/column 30/15; end line/column 30/21, lhs=IdExpression{id='counter', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 30/25; end line/column 30/25, value=1}, value=null}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 33/1; end line/column 33/3, head=FixedTextImpl{codePosition=begin line/column 33/1; end line/column 33/3, textBuffer=And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 33/11; end line/column 33/15, textBuffer=}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  'John' ) '}, DynamicContentReference{name='Global Variable: lastName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lastName',  'Connor' ) '}, Text{name='text', text='This is some fixed text for you.'}, ListDeclaration{listVariableName='liste99', components='[]'}, ListAddItem{listVariableName='liste99', newValue='1', components='[]'}, ListAddItem{listVariableName='liste99', newValue='2', components='[]'}, ListAddItem{listVariableName='liste99', newValue='3', components='[]'}, ListAddItem{listVariableName='liste99', newValue='4', components='[]'}, ListAddItem{listVariableName='liste99', newValue='5', components='[]'}, ListDeclaration{listVariableName='liste98', components='[]'}, ListAddItem{listVariableName='liste98', newValue=' 'Die' ', components='[]'}, ListAddItem{listVariableName='liste98', newValue=' 'fiend' ', components='[]'}, ListAddItem{listVariableName='liste98', newValue=' 'die' ', components='[]'}, ListDeclaration{listVariableName='liste97', components='[]'}, ListAddItem{listVariableName='liste97', newValue=' 'Horrido' ', components='[]'}, ListAddItem{listVariableName='liste97', newValue=' 'auf' ', components='[]'}, ListAddItem{listVariableName='liste97', newValue=' 'und' ', components='[]'}, ListAddItem{listVariableName='liste97', newValue=' 'der' ', components='[]'}, ListAddItem{listVariableName='liste97', newValue=' 'Gas' ', components='[]'}, ListAddItem{listVariableName='liste97', newValue=' 'nach' ', components='[]'}, ListAddItem{listVariableName='liste97', newValue='1', components='[]'}, ListAddItem{listVariableName='liste97', newValue='2', components='[]'}, ListAddItem{listVariableName='liste97', newValue='3', components='[]'}, ListAddItem{listVariableName='liste97', newValue='4', components='[]'}, ListAddItem{listVariableName='liste97', newValue='5', components='[]'}, DynamicContentReference{name='Append List liste98 to liste97', xpath=' hit2assext:appendList(var:read('renderSessionUuid'), 'liste98', 'liste97') '}, DynamicContentReference{name='Append List liste99 to liste97', xpath=' hit2assext:appendList(var:read('renderSessionUuid'), 'liste99', 'liste97') '}, ListAddItem{listVariableName='liste97', newValue='99', components='[]'}, ListAddItem{listVariableName='liste97', newValue='98', components='[]'}, ListAddItem{listVariableName='liste97', newValue='96', components='[]'}, ListAddItem{listVariableName='liste97', newValue='30', components='[]'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, Text{name='text', text='Hello '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, Text{name='text', text=','}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Hello '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, Text{name='text', text='!'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, DynamicContentReference{name='Print: liste98', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'liste98', 1)'}, Text{name='text', text=' '}, DynamicContentReference{name='Print: liste98', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'liste98', 2)'}, Text{name='text', text=' '}, DynamicContentReference{name='Print: liste98', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'liste98', 3)'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, DynamicContentReference{name='Global Variable: length', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'liste99' ) ) '}, Text{name='text', text='liste99 should have 5 elements, and actually it has '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, Text{name='text', text=' elements.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: length', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'liste98' )  )'}, Text{name='text', text='liste98 should have 3 elements, and actually it has '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, Text{name='text', text=' elements.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: length', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'length',  hit2assext:getListLength(var:read('renderSessionUuid'),  'liste97' )  )'}, Text{name='text', text='liste97 should have 23 elements, and actually it has '}, DynamicContentReference{name='Print: length', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'length')  '}, Text{name='text', text=' elements.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='And these are the items of liste97:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Global Variable: counter', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'counter', 1) '}, ForLoop{expression=ClouFunctionCall{codePosition=begin line/column 28/4; end line/column 28/10, functionName='listlen', args=( 'liste97'  ) }, components=[DynamicContentReference{name='Print: liste97', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'liste97',  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')  )'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Scalar Assignment: counter', xpath='hit2assext:setScalarVariableValue(var:read('renderSessionUuid'), 'counter', ( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'counter')   + 1) )'}]}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testIndexExpressions() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("IndexExpressions"), "ISO8859-1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/4; end line/column 5/11, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/4; end line/column 5/11, head=GlobalListDeclarationStatement{codePosition=begin line/column 5/4; end line/column 5/11, listId='l vombis', listExpression=PairExpressionList{head=NumExpression{codePosition=begin line/column 5/17; end line/column 5/17, value=1}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 5/20; end line/column 5/20, value=2}, tail=PairExpressionList{head=TextExpression{codePosition=begin line/column 5/23; end line/column 5/25, value='J'}, tail=PairExpressionList{head=NumExpression{codePosition=begin line/column 5/28; end line/column 5/28, value=4}, tail=LastExpressionList{codePosition=begin line/column 5/31; end line/column 5/31head='NumExpression{codePosition=begin line/column 5/31; end line/column 5/31, value=5}}}}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/16; end line/column 6/16, head=GlobalDeclarationStatement{codePosition=begin line/column 6/16; end line/column 6/16, expression=NumExpression{codePosition=begin line/column 6/16; end line/column 6/16, value=3}, id='list df anz', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/20; end line/column 7/20, head=GlobalDeclarationStatement{codePosition=begin line/column 7/20; end line/column 7/20, expression=NumExpression{codePosition=begin line/column 7/20; end line/column 7/20, value=1}, id='durchlaufzähler', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/4; end line/column 9/11, head=ConditionalStatement{codePosition=begin line/column 9/4; end line/column 9/11, condition=BinaryOperatorExpression{codePosition=begin line/column 9/4; end line/column 9/11, lhs=IdExpression{id='l vombis', idxExp1=LastExpressionList{codePosition=begin line/column 9/14; end line/column 9/28head='BinaryOperatorExpression{codePosition=begin line/column 9/14; end line/column 9/28, lhs=BinaryOperatorExpression{codePosition=begin line/column 9/14; end line/column 9/28, lhs=BinaryOperatorExpression{codePosition=begin line/column 9/14; end line/column 9/28, lhs=IdExpression{id='durchlaufzähler', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=MINUS, rhs=NumExpression{codePosition=begin line/column 9/30; end line/column 9/30, value=1}, value=null}, operator=TIMES, rhs=IdExpression{id='list df anz', idxExp1=null, idxExp2=null, valueType=null, value=null}, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 9/49; end line/column 9/49, value=3}, value=null}}, idxExp2=null, valueType=null, value=null}, operator=EQ, rhs=TextExpression{codePosition=begin line/column 9/54; end line/column 9/56, value='J'}, value=null}, thenElement=PairClouBausteinElementList{codePosition=begin line/column 11/9; end line/column 11/10, head=FixedTextImpl{codePosition=begin line/column 11/9; end line/column 11/10, textBuffer=as expected: \"J\"}, tail=LastClouBausteinElementList{head=SectionStatement{}}}, elseElement=PairClouBausteinElementList{codePosition=begin line/column 13/9; end line/column 13/17, head=FixedTextImpl{codePosition=begin line/column 13/9; end line/column 13/17, textBuffer=something did not work out, keep debugging. }, tail=LastClouBausteinElementList{head=SectionStatement{}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 15/4; end line/column 15/11, head=PrintStatement{codePosition=begin line/column 15/4; end line/column 15/11, expression='IdExpression{id='l vombis', idxExp1=LastExpressionList{codePosition=begin line/column 15/14; end line/column 15/28head='BinaryOperatorExpression{codePosition=begin line/column 15/14; end line/column 15/28, lhs=BinaryOperatorExpression{codePosition=begin line/column 15/14; end line/column 15/28, lhs=BinaryOperatorExpression{codePosition=begin line/column 15/14; end line/column 15/28, lhs=IdExpression{id='durchlaufzähler', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=MINUS, rhs=NumExpression{codePosition=begin line/column 15/30; end line/column 15/30, value=1}, value=null}, operator=TIMES, rhs=IdExpression{id='list df anz', idxExp1=null, idxExp2=null, valueType=null, value=null}, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 15/45; end line/column 15/45, value=1}, value=null}}, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 17/1; end line/column 17/3, head=FixedTextImpl{codePosition=begin line/column 17/1; end line/column 17/3, textBuffer= And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 17/11; end line/column 17/15, textBuffer=}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[ListDeclaration{listVariableName='l vombis', components='[]'}, ListAddItem{listVariableName='l vombis', newValue='1', components='[]'}, ListAddItem{listVariableName='l vombis', newValue='2', components='[]'}, ListAddItem{listVariableName='l vombis', newValue=' 'J' ', components='[]'}, ListAddItem{listVariableName='l vombis', newValue='4', components='[]'}, ListAddItem{listVariableName='l vombis', newValue='5', components='[]'}, DynamicContentReference{name='Global Variable: list df anz', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'list df anz', 3) '}, DynamicContentReference{name='Global Variable: durchlaufzähler', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'durchlaufzähler', 1) '}, IfThenElseParagraph{condition=BinaryOperatorExpression{codePosition=begin line/column 9/4; end line/column 9/11, lhs=IdExpression{id='l vombis', idxExp1=LastExpressionList{codePosition=begin line/column 9/14; end line/column 9/28head='BinaryOperatorExpression{codePosition=begin line/column 9/14; end line/column 9/28, lhs=BinaryOperatorExpression{codePosition=begin line/column 9/14; end line/column 9/28, lhs=BinaryOperatorExpression{codePosition=begin line/column 9/14; end line/column 9/28, lhs=IdExpression{id='durchlaufzähler', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=MINUS, rhs=NumExpression{codePosition=begin line/column 9/30; end line/column 9/30, value=1}, value=null}, operator=TIMES, rhs=IdExpression{id='list df anz', idxExp1=null, idxExp2=null, valueType=null, value=null}, value=null}, operator=PLUS, rhs=NumExpression{codePosition=begin line/column 9/49; end line/column 9/49, value=3}, value=null}}, idxExp2=null, valueType=null, value=null}, operator=EQ, rhs=TextExpression{codePosition=begin line/column 9/54; end line/column 9/56, value='J'}, value=null}, components=[IfThenParagraph{components=[Text{name='text', text='as expected: \"J\"'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}, IfElseParagraph{components=[Text{name='text', text='something did not work out, keep debugging. '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}]}, DynamicContentReference{name='Print: l vombis', xpath=' hit2assext:getListValueAt(var:read('renderSessionUuid'), 'l vombis', ((( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'durchlaufzähler')   - 1) *  hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'list df anz')  ) + 1))'}, Text{name='text', text=' And so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testShellVariable() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("ShellVariable"), "ISO8859-1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        String probe = baustein.toString();
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/12; end line/column 5/24, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/12; end line/column 5/24, head=GlobalDeclarationStatement{codePosition=begin line/column 5/12; end line/column 5/24, expression=ClouFunctionCall{codePosition=begin line/column 5/12; end line/column 5/24, functionName='SHELLVARIABLE', args=( 'testValue'  ) }, id='myValue', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/1; end line/column 6/6, head=FixedTextImpl{codePosition=begin line/column 6/1; end line/column 6/6, textBuffer=System property \"testValue\" has this value: }, tail=PairClouBausteinElementList{codePosition=begin line/column 6/48; end line/column 6/54, head=PrintStatement{codePosition=begin line/column 6/48; end line/column 6/54, expression='IdExpression{id='myValue', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/55; end line/column 6/55, head=FixedTextImpl{codePosition=begin line/column 6/55; end line/column 6/55, textBuffer=.}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/56; end line/column 6/56, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/1; end line/column 7/7, head=FixedTextImpl{codePosition=begin line/column 7/1; end line/column 7/7, textBuffer=Testing the function call in the context of a print statement: }, tail=PairClouBausteinElementList{codePosition=begin line/column 7/67; end line/column 7/79, head=PrintStatement{codePosition=begin line/column 7/67; end line/column 7/79, expression='ClouFunctionCall{codePosition=begin line/column 7/67; end line/column 7/79, functionName='SHELLVARIABLE', args=( 'testValue'  ) }'}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/93; end line/column 7/93, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/1; end line/column 8/3, head=FixedTextImpl{codePosition=begin line/column 8/1; end line/column 8/3, textBuffer=Ein Betrag von }, tail=PairClouBausteinElementList{codePosition=begin line/column 8/19; end line/column 8/19, head=PrintStatement{codePosition=begin line/column 8/19; end line/column 8/19, expression='IdExpression{id='W', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 0/0; end line/column 0/0, head=FixedTextImpl{codePosition=begin line/column 0/0; end line/column 0/0, textBuffer= }, tail=PairClouBausteinElementList{codePosition=begin line/column 8/24; end line/column 8/30, head=PrintStatement{codePosition=begin line/column 8/24; end line/column 8/30, expression='ClouFunctionCall{codePosition=begin line/column 8/24; end line/column 8/30, functionName='replace', args=( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'dbgutbetr')  ,  ' ' ,  ''  ) }'}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/50; end line/column 8/54, head=FixedTextImpl{codePosition=begin line/column 8/50; end line/column 8/54, textBuffer= wurde bereits überwiesen.}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/75; end line/column 8/75, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/1; end line/column 10/5, head=FixedTextImpl{codePosition=begin line/column 10/1; end line/column 10/5, textBuffer=Jetzt mit IF statement:}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/24; end line/column 10/24, head=SectionStatement{}, tail=PairClouBausteinElementList{codePosition=begin line/column 11/4; end line/column 11/16, head=ConditionalStatement{codePosition=begin line/column 11/4; end line/column 11/16, condition=BinaryOperatorExpression{codePosition=begin line/column 11/4; end line/column 11/16, lhs=ClouFunctionCall{codePosition=begin line/column 11/4; end line/column 11/16, functionName='SHELLVARIABLE', args=( 'AEFRNR'  ) }, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 11/31; end line/column 11/34, value='--'}, value=null}, thenElement=PairClouBausteinElementList{codePosition=begin line/column 13/6; end line/column 13/8, head=FixedTextImpl{codePosition=begin line/column 13/6; end line/column 13/8, textBuffer=^4( }, tail=PairClouBausteinElementList{codePosition=begin line/column 13/12; end line/column 13/24, head=PrintStatement{codePosition=begin line/column 13/12; end line/column 13/24, expression='ClouFunctionCall{codePosition=begin line/column 13/12; end line/column 13/24, functionName='SHELLVARIABLE', args=( 'AEFRNR'  ) }'}, tail=PairClouBausteinElementList{codePosition=begin line/column 13/35; end line/column 13/35, head=FixedTextImpl{codePosition=begin line/column 13/35; end line/column 13/35, textBuffer=^ ^?}, tail=LastClouBausteinElementList{head=SectionStatement{}}}}}, elseElement=PairClouBausteinElementList{codePosition=begin line/column 15/6; end line/column 15/9, head=FixedTextImpl{codePosition=begin line/column 15/6; end line/column 15/9, textBuffer=^4(^ ^?}, tail=LastClouBausteinElementList{head=SectionStatement{}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 19/1; end line/column 19/3, head=FixedTextImpl{codePosition=begin line/column 19/1; end line/column 19/3, textBuffer=And so it ends.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 19/11; end line/column 19/15, textBuffer=}}}}}}}}}}}}}}}}}}}}}", probe);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        probe = workspace.toString();
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[DynamicContentReference{name='Global Variable: myValue', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'myValue',  hit2assext:getSystemProperty( 'testValue' ) ) '}, Text{name='text', text='System property \"testValue\" has this value: '}, DynamicContentReference{name='Print: myValue', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'myValue')  '}, Text{name='text', text='.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Testing the function call in the context of a print statement: '}, DynamicContentReference{name='Print: ()', xpath=' hit2assext:getSystemProperty( 'testValue' ) '}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Ein Betrag von '}, DynamicContentReference{name='Print: W', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'W')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: ()', xpath='replace( hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'dbgutbetr')  ,  ' ' ,  ''  )'}, Text{name='text', text=' wurde bereits überwiesen.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='Jetzt mit IF statement:'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, IfThenElseParagraph{condition=BinaryOperatorExpression{codePosition=begin line/column 11/4; end line/column 11/16, lhs=ClouFunctionCall{codePosition=begin line/column 11/4; end line/column 11/16, functionName='SHELLVARIABLE', args=( 'AEFRNR'  ) }, operator=NEQ, rhs=TextExpression{codePosition=begin line/column 11/31; end line/column 11/34, value='--'}, value=null}, components=[IfThenParagraph{components=[Text{name='text', text='^4( '}, DynamicContentReference{name='Print: ()', xpath=' hit2assext:getSystemProperty( 'AEFRNR' ) '}, Text{name='text', text='^ ^?'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}, IfElseParagraph{components=[Text{name='text', text='^4(^ ^?'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}]}]}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testInsertBlanksVisitor() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("InsertBlanksVisitorTest"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  'John' ) '}, DynamicContentReference{name='Global Variable: lastName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'lastName',  'Connor' ) '}, Text{name='text', text='You are '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' '}, DynamicContentReference{name='Print: lastName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'lastName')  '}, Text{name='text', text='.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, Text{name='text', text='You are \"'}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text='\".'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='2'}, Text{name='text', text='Please give '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=' my love. And so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testTabu() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("TabuTest"), "ISO8859_1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String probe = workspace.toString();
        assertFalse(StringUtils.isBlank(probe));
        assertEquals("Workspace{workspaceName='HitAssWorkspace', projectsName='HitAssProjects', projectName='HitAssProject', documentName='HitAssDocument', repeatingPageName='HitAssRepeatingPage', pageContentName='HitAssPageContent', contentContainer=Paragraph{contentElements=[Text{name='text', text='Here is some fixed text to get started.'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, DynamicContentReference{name='Global Variable: firstName', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'firstName',  'Johnny' ) '}, DynamicContentReference{name='Global Variable: TABU', xpath=' hit2assext:createScalarVariable(var:read('renderSessionUuid'), 'TABU',  '       ' ) '}, Text{name='text', text='Your name is'}, Text{name='TABU', text='       '}, DynamicContentReference{name='Print: firstName', xpath=' hit2assext:getScalarVariableValue(var:read('renderSessionUuid'), 'firstName')  '}, Text{name='text', text=', right?'}, CarriageReturn{name='NL', repetitionExpression.toXPathString()='1'}, Text{name='text', text='And so it ends.'}, Text{name='text', text=''}]}}", probe);
    }

    @Test
    public void testSimpleIfLetter() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("/sampleDocuments/SimpleIfLetter/", "SimpleIfLetter", "clou"), "ISO8859-1");
        baustein = parser.CB();
        baustein.accept(merger);
        baustein.accept(blanksVisitor);
        baustein.accept(irTransformer);
        Workspace workspace = irTransformer.getWorkspace();
        assertNotNull(workspace);
        String acr = workspace.getContent();
        assertFalse(StringUtils.isBlank(acr));
        // check that InsertBlanksVisitor does not insert blanks before punctuation characters.
        assertTrue(acr.contains("<![CDATA[.]]"));
        // check that InsertBlanksVisitor inserts blanks between FixedText and PrintStatements
        assertTrue(acr.contains("den Versand von einem ]]"));
        // check that InsertBlanksVisitor inserts blanks between PrintStatements
        assertTrue(acr.contains("<![CDATA[ ]]"));
    }

}
