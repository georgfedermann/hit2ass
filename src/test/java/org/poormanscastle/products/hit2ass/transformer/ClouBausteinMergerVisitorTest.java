package org.poormanscastle.products.hit2ass.transformer;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

import org.poormanscastle.products.hit2ass.TestUtils;
import org.poormanscastle.products.hit2ass.ast.domain.ClouBaustein;
import org.poormanscastle.products.hit2ass.parser.javacc.HitAssAstParser;

/**
 * TODO migrate old unit tests to new test strategy based on AST analyzation.
 * Created by georg.federmann@poormanscastle.com on 4/27/16.
 */
public class ClouBausteinMergerVisitorTest {

    private HitAssAstParser parser;
    private ClouBausteinMergerVisitor bausteinMerger = new ClouBausteinMergerVisitor();
    private ClouBaustein baustein;

    // @Test
    public void visitIncludeBausteinStatement() throws Exception {
        parser = new HitAssAstParser(TestUtils.getClouBausteinAsInputStream("IncludeBausteinParent"), "UTF-8");
        baustein = parser.CB();
        baustein.accept(bausteinMerger);
        String probe = baustein.toString();
        assertNotNull(probe);
        // assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/14; end line/column 5/18, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/14; end line/column 5/18, head=GlobalDeclarationStatement{codePosition=begin line/column 5/14; end line/column 5/18, expression=TextExpression{codePosition=begin line/column 5/14; end line/column 5/18, value='Jim'}, id='firstName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/13; end line/column 6/20, head=GlobalDeclarationStatement{codePosition=begin line/column 6/13; end line/column 6/20, expression=TextExpression{codePosition=begin line/column 6/13; end line/column 6/20, value='Raynor'}, id='lastName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/11; end line/column 7/13, head=GlobalDeclarationStatement{codePosition=begin line/column 7/11; end line/column 7/13, expression=TextExpression{codePosition=begin line/column 7/11; end line/column 7/13, value='m'}, id='gender', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/17; end line/column 8/23, head=GlobalDeclarationStatement{codePosition=begin line/column 8/17; end line/column 8/23, expression=TextExpression{codePosition=begin line/column 8/17; end line/column 8/23, value='Adler'}, id='shoppingItem', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/4; end line/column 10/31, head=PairClouBausteinElementList{codePosition=begin line/column 2/4; end line/column 2/9, head=ConditionalStatement{codePosition=begin line/column 2/4; end line/column 2/9, condition=BinaryOperatorExpression{codePosition=begin line/column 2/4; end line/column 2/9, lhs=IdExpression{id='gender', valueType=null, value=null}, operator=EQ, rhs=TextExpression{codePosition=begin line/column 2/13; end line/column 2/15, value='m'}, value=null}, thenElement=PairClouBausteinElementList{codePosition=begin line/column 3/7; end line/column 3/10, head=FixedTextImpl{codePosition=begin line/column 3/7; end line/column 3/10, textBuffer=Sehr geehrter Herr}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 3/21; end line/column 3/24, textBuffer=}}}, elseElement=PairClouBausteinElementList{codePosition=begin line/column 4/7; end line/column 4/10, head=FixedTextImpl{codePosition=begin line/column 4/7; end line/column 4/10, textBuffer=Sehr geehrte Frau}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 4/20; end line/column 4/23, textBuffer=}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/4; end line/column 6/12, head=PrintStatement{codePosition=begin line/column 6/4; end line/column 6/12, symbolId='firstName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/17; end line/column 6/24, head=PrintStatement{codePosition=begin line/column 6/17; end line/column 6/24, symbolId='lastName'}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/1; end line/column 7/2, head=HitCommandStatement{codePosition=begin line/column 7/1; end line/column 7/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 7/3; end line/column 7/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/1; end line/column 8/3, head=FixedTextImpl{codePosition=begin line/column 8/1; end line/column 8/3, textBuffer=Wir danken Ihnen für die Bestellung und bestätigen Ihnen den Versand von einem}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/83; end line/column 8/94, head=PrintStatement{codePosition=begin line/column 8/83; end line/column 8/94, symbolId='shoppingItem'}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/95; end line/column 8/95, head=FixedTextImpl{codePosition=begin line/column 8/95; end line/column 8/95, textBuffer=.}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/1; end line/column 9/2, head=HitCommandStatement{codePosition=begin line/column 9/1; end line/column 9/2, hitCommand=RETURN, repetitor=IdExpression{id='numberOfNewLines', valueType=null, value=null}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/1; end line/column 10/4, head=FixedTextImpl{codePosition=begin line/column 10/1; end line/column 10/4, textBuffer=Ihre ACME AG.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 10/11; end line/column 10/13, textBuffer=}}}}}}}}}}}'}, tail=LastClouBausteinElementList{head=PairClouBausteinElementList{codePosition=begin line/column 2/1; end line/column 2/6, head=FixedTextImpl{codePosition=begin line/column 2/1; end line/column 2/6, textBuffer=Please find attached a wonderful gift from us for you.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 2/51; end line/column 2/54, textBuffer=}}}'}}}}}}}}", probe);
        assertEquals("ClouBausteinImpl{codePosition=begin line/column 5/14; end line/column 5/18, clouBausteinElement=PairClouBausteinElementList{codePosition=begin line/column 5/14; end line/column 5/18, head=GlobalDeclarationStatement{codePosition=begin line/column 5/14; end line/column 5/18, expression=TextExpression{codePosition=begin line/column 5/14; end line/column 5/18, value='Jim'}, id='firstName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/13; end line/column 6/20, head=GlobalDeclarationStatement{codePosition=begin line/column 6/13; end line/column 6/20, expression=TextExpression{codePosition=begin line/column 6/13; end line/column 6/20, value='Raynor'}, id='lastName', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/11; end line/column 7/13, head=GlobalDeclarationStatement{codePosition=begin line/column 7/11; end line/column 7/13, expression=TextExpression{codePosition=begin line/column 7/11; end line/column 7/13, value='m'}, id='gender', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/17; end line/column 8/23, head=GlobalDeclarationStatement{codePosition=begin line/column 8/17; end line/column 8/23, expression=TextExpression{codePosition=begin line/column 8/17; end line/column 8/23, value='Adler'}, id='shoppingItem', formatDefinition=''}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/4; end line/column 10/31, head=IncludeBausteinStatement{codePosition=begin line/column 10/4; end line/column 10/31, pathToBaustein='\"IncludeBausteinChild1.clou\"', content='PairClouBausteinElementList{codePosition=begin line/column 2/4; end line/column 2/9, head=ConditionalStatement{codePosition=begin line/column 2/4; end line/column 2/9, condition=BinaryOperatorExpression{codePosition=begin line/column 2/4; end line/column 2/9, lhs=IdExpression{id='gender', idxExp1=null, idxExp2=null, valueType=null, value=null}, operator=EQ, rhs=TextExpression{codePosition=begin line/column 2/13; end line/column 2/15, value='m'}, value=null}, thenElement=PairClouBausteinElementList{codePosition=begin line/column 3/7; end line/column 3/10, head=FixedTextImpl{codePosition=begin line/column 3/7; end line/column 3/10, textBuffer=Sehr geehrter Herr}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 3/21; end line/column 3/24, textBuffer=}}}, elseElement=PairClouBausteinElementList{codePosition=begin line/column 4/7; end line/column 4/10, head=FixedTextImpl{codePosition=begin line/column 4/7; end line/column 4/10, textBuffer=Sehr geehrte Frau}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 4/20; end line/column 4/23, textBuffer=}}}}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/4; end line/column 6/12, head=PrintStatement{codePosition=begin line/column 6/4; end line/column 6/12, expression='IdExpression{id='firstName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 6/17; end line/column 6/24, head=PrintStatement{codePosition=begin line/column 6/17; end line/column 6/24, expression='IdExpression{id='lastName', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 7/1; end line/column 7/2, head=HitCommandStatement{codePosition=begin line/column 7/1; end line/column 7/2, hitCommand=RETURN, repetitor=NumExpression{codePosition=begin line/column 7/3; end line/column 7/3, value=2}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/1; end line/column 8/3, head=FixedTextImpl{codePosition=begin line/column 8/1; end line/column 8/3, textBuffer=Wir danken Ihnen für die Bestellung und bestätigen Ihnen den Versand von einem}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/83; end line/column 8/94, head=PrintStatement{codePosition=begin line/column 8/83; end line/column 8/94, expression='IdExpression{id='shoppingItem', idxExp1=null, idxExp2=null, valueType=null, value=null}'}, tail=PairClouBausteinElementList{codePosition=begin line/column 8/95; end line/column 8/95, head=FixedTextImpl{codePosition=begin line/column 8/95; end line/column 8/95, textBuffer=.}, tail=PairClouBausteinElementList{codePosition=begin line/column 9/1; end line/column 9/2, head=HitCommandStatement{codePosition=begin line/column 9/1; end line/column 9/2, hitCommand=RETURN, repetitor=IdExpression{id='numberOfNewLines', idxExp1=null, idxExp2=null, valueType=null, value=null}, verstarkt=false}, tail=PairClouBausteinElementList{codePosition=begin line/column 10/1; end line/column 10/4, head=FixedTextImpl{codePosition=begin line/column 10/1; end line/column 10/4, textBuffer=Ihre ACME AG.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 10/11; end line/column 10/13, textBuffer=}}}}}}}}}}}'}, tail=LastClouBausteinElementList{head=IncludeBausteinStatement{codePosition=begin line/column 12/4; end line/column 12/43, pathToBaustein='\"$BAUPFAD/ba/IncludeBausteinChild2.clou\"', content='PairClouBausteinElementList{codePosition=begin line/column 2/1; end line/column 2/6, head=FixedTextImpl{codePosition=begin line/column 2/1; end line/column 2/6, textBuffer=Please find attached a wonderful gift from us for you.}, tail=LastClouBausteinElementList{head=FixedTextImpl{codePosition=begin line/column 2/51; end line/column 2/54, textBuffer=}}}'}}}}}}}}", probe);
    }

}